name: Gate Light

on:
  pull_request:
  push:
  workflow_dispatch:

jobs:
  gate-light:
    name: gate-light
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # a) actionlint (Workflow static check)
      - name: Actionlint
        uses: devops-actions/actionlint@e7ee33fbf5aa8c9f9ee1145137f3e52e25d6a35b # v0.1.3

      # b) gitleaks（密钥泄漏扫描）
      - name: Gitleaks
        uses: gacts/gitleaks@v1

      # c) Schema（模式定义）校验：fixtures/*.json 必须都能过 schema
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - name: Schema validation (rules/gates/fixtures/*.json)
        shell: bash
        run: |
          set -euo pipefail
          python -m pip install --disable-pip-version-check --no-cache-dir jsonschema

          python - <<'PY'
          import glob, json, sys
          from pathlib import Path
          import jsonschema

          schema_path = Path("rules/gates/schema/envelope.schema.json")
          if not schema_path
::contentReference[oaicite:0]{index=0}
